{% extends "base.html" %} {% block content %}
<div class="section-header">
  <h2>
    <svg
      width="18"
      height="18"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    >
      <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
    </svg>
    System Health
  </h2>
  <a href="/api/v1/health" target="_blank" rel="noreferrer" class="badge"
    >API Endpoint →</a
  >
</div>

<div class="health-grid">
  <!-- Job Queue -->
  <div class="health-card">
    <div class="health-card-header">
      <span class="health-card-title">Job Queue</span>
      {% if info.queue %}
      <span
        class="status-dot {{ 'ok' if info.queue.get('running', 0) > 0 or info.queue.get('queued', 0) == 0 else 'warn' }}"
      ></span>
      {% endif %}
    </div>
    {% if info.queue %}
    <div class="health-card-value">
      {{ info.queue.get('queued', 0) }} queued
    </div>
    <div class="health-card-detail">
      {{ info.queue.get('running', 0) }} running · {{
      info.queue.get('completed', 0) }} completed · {{ info.queue.get('failed',
      0) }} failed
    </div>
    {% else %}
    <div class="health-card-value muted">—</div>
    {% endif %}
  </div>

  <!-- Chat Queue -->
  <div class="health-card">
    <div class="health-card-header">
      <span class="health-card-title">Chat Queue</span>
      {% if info.chat_queue %}
      <span
        class="status-dot {{ 'ok' if info.chat_queue.get('running', 0) > 0 or info.chat_queue.get('queued', 0) == 0 else 'warn' }}"
      ></span>
      {% endif %}
    </div>
    {% if info.chat_queue %}
    <div class="health-card-value">
      {{ info.chat_queue.get('queued', 0) }} queued
    </div>
    <div class="health-card-detail">
      {{ info.chat_queue.get('running', 0) }} running · {{
      info.chat_queue.get('completed', 0) }} completed
    </div>
    {% else %}
    <div class="health-card-value muted">—</div>
    {% endif %}
  </div>

  <!-- Database -->
  <div class="health-card">
    <div class="health-card-header">
      <span class="health-card-title">Database</span>
      <span class="status-dot ok"></span>
    </div>
    <div
      class="health-card-value"
      style="font-size: 14px; word-break: break-all"
    >
      {{ info.run_db_path }}
    </div>
    <div class="health-card-detail">SQLite run & chat store</div>
  </div>

  <!-- Router Config -->
  <div class="health-card">
    <div class="health-card-header">
      <span class="health-card-title">Router Config</span>
      <span class="status-dot ok"></span>
    </div>
    <div class="health-card-value" style="font-size: 14px">
      {{ info.router_config }}
    </div>
    <div class="health-card-detail">Mode routing configuration</div>
  </div>

  <!-- Sources Config -->
  <div class="health-card">
    <div class="health-card-header">
      <span class="health-card-title">Sources</span>
      <span class="status-dot ok"></span>
    </div>
    <div class="health-card-value" style="font-size: 14px">
      {{ info.sources_config }}
    </div>
    <div class="health-card-detail">Live source definitions</div>
  </div>

  <!-- Automation Config -->
  <div class="health-card">
    <div class="health-card-header">
      <span class="health-card-title">Automation</span>
      <span class="status-dot ok"></span>
    </div>
    <div class="health-card-value" style="font-size: 14px">
      {{ info.automation_config }}
    </div>
    <div class="health-card-detail">Automation pipeline config</div>
  </div>
</div>

<!-- Artifact Roots -->
<div class="card">
  <h2>
    <svg
      width="16"
      height="16"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    >
      <path
        d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"
      />
    </svg>
    Artifact Roots
  </h2>
  {% if info.artifacts_roots %}
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Path</th>
      </tr>
    </thead>
    <tbody>
      {% for root in info.artifacts_roots %}
      <tr>
        <td>{{ loop.index }}</td>
        <td><code>{{ root }}</code></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="muted">No artifact roots configured.</p>
  {% endif %}
</div>

<!-- Raw JSON (collapsible) -->
<details>
  <summary>Raw Health JSON</summary>
  <pre class="log">{{ info | tojson(indent=2) }}</pre>
</details>
{% endblock %}
